<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Match Predictor</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f7f7f7;
        padding: 20px;
      }

      h1 {
        text-align: center;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 14px;
        background: #fff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      th {
        background: #333;
        color: #fff;
        padding: 8px;
        text-align: center;
      }

      td {
        padding: 6px 10px;
        border: 1px solid #ddd;
        text-align: center;
      }

      tr.team-separator td {
        border: none;
        height: 14px;
        background: transparent;
      }

      tr.blue-team td {
        background: #e8f4ff;
      }

      tr.red-team td {
        background: #ffe8e8;
      }

      .button {
        margin-top: 20px;
        display: block;
        padding: 10px 20px;
        font-size: 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .button:hover {
        background: #0056b3;
      }

      #results {
        margin-top: 30px;
      }

      .team-summary {
        margin-bottom: 20px;
        padding: 10px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .team-summary h2 {
        margin: 0;
        font-size: 18px;
      }

      .team-summary span {
        font-weight: bold;
        font-size: 16px;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <h1>League Match Predictor</h1>

    <table id="csv-table"></table>

    <button class="button" onclick="sendToAPI()">Predict</button>

    <div id="results"></div>

    <script>
      // Preloaded CSV data (your same array)
      const csvData = [
        {
          side: "Blue",
          position: "Top",
          player: "Doran",
          team: "Hanhwa Life Esports",
          champion: "Rumble",
          ban1: "Azir",
          ban2: "Ashe",
          ban3: "Nidalee",
          ban4: "Kalista",
          ban5: "Senna",
          k: 1,
          d: 0,
          a: 0,
          fb: 1,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 0,
          oppdragkills: 1,
          elementals: 0,
          oppelementals: 1,
          herald: "",
          wards: 8,
          csat10: 87,
          oppcsat10: 59,
          csdat10: 28,
          results: 1,
        },
        {
          side: "Blue",
          position: "Jungle",
          player: "Peanut",
          team: "Hanhwa Life Esports",
          champion: "Poppy",
          ban1: "Azir",
          ban2: "Ashe",
          ban3: "Nidalee",
          ban4: "Kalista",
          ban5: "Senna",
          k: 0,
          d: 0,
          a: 1,
          fb: 0,
          fbassist: 1,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 0,
          oppdragkills: 1,
          elementals: 0,
          oppelementals: 1,
          herald: "",
          wards: 6,
          csat10: 73,
          oppcsat10: 66,
          csdat10: 7,
          results: 1,
        },
        {
          side: "Blue",
          position: "Middle",
          player: "Zeka",
          team: "Hanhwa Life Esports",
          champion: "Corki",
          ban1: "Azir",
          ban2: "Ashe",
          ban3: "Nidalee",
          ban4: "Kalista",
          ban5: "Senna",
          k: 0,
          d: 1,
          a: 0,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 0,
          oppdragkills: 1,
          elementals: 0,
          oppelementals: 1,
          herald: "",
          wards: 6,
          csat10: 100,
          oppcsat10: 95,
          csdat10: 5,
          results: 1,
        },
        {
          side: "Blue",
          position: "ADC",
          player: "Viper",
          team: "Hanhwa Life Esports",
          champion: "Ezreal",
          ban1: "Azir",
          ban2: "Ashe",
          ban3: "Nidalee",
          ban4: "Kalista",
          ban5: "Senna",
          k: 0,
          d: 0,
          a: 0,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 0,
          oppdragkills: 1,
          elementals: 0,
          oppelementals: 1,
          herald: "",
          wards: 4,
          csat10: 90,
          oppcsat10: 96,
          csdat10: -6,
          results: 1,
        },
        {
          side: "Blue",
          position: "Support",
          player: "Delight",
          team: "Hanhwa Life Esports",
          champion: "Alistar",
          ban1: "Azir",
          ban2: "Ashe",
          ban3: "Nidalee",
          ban4: "Kalista",
          ban5: "Senna",
          k: 0,
          d: 1,
          a: 0,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 0,
          oppdragkills: 1,
          elementals: 0,
          oppelementals: 1,
          herald: "",
          wards: 9,
          csat10: 19,
          oppcsat10: 8,
          csdat10: 11,
          results: 1,
        },

        {
          side: "Red",
          position: "Top",
          player: "Zeus",
          team: "T1",
          champion: "Gnar",
          ban1: "Maokai",
          ban2: "Ivern",
          ban3: "Vi",
          ban4: "Rakan",
          ban5: "Leona",
          k: 0,
          d: 1,
          a: 0,
          fb: 0,
          fbassist: 0,
          fbvictim: 1,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 1,
          oppdragkills: 0,
          elementals: 1,
          oppelementals: 0,
          herald: "",
          wards: 5,
          csat10: 59,
          oppcsat10: 87,
          csdat10: -28,
          results: 0,
        },
        {
          side: "Red",
          position: "Jungle",
          player: "Oner",
          team: "T1",
          champion: "Sejuani",
          ban1: "Maokai",
          ban2: "Ivern",
          ban3: "Vi",
          ban4: "Rakan",
          ban5: "Leona",
          k: 1,
          d: 0,
          a: 0,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 1,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 1,
          oppdragkills: 0,
          elementals: 1,
          oppelementals: 0,
          herald: "",
          wards: 9,
          csat10: 66,
          oppcsat10: 73,
          csdat10: -7,
          results: 0,
        },
        {
          side: "Red",
          position: "Middle",
          player: "Faker",
          team: "T1",
          champion: "Tristana",
          ban1: "Maokai",
          ban2: "Ivern",
          ban3: "Vi",
          ban4: "Rakan",
          ban5: "Leona",
          k: 0,
          d: 0,
          a: 1,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 1,
          oppdragkills: 0,
          elementals: 1,
          oppelementals: 0,
          herald: "",
          wards: 6,
          csat10: 95,
          oppcsat10: 100,
          csdat10: -5,
          results: 0,
        },
        {
          side: "Red",
          position: "ADC",
          player: "Gumayusi",
          team: "T1",
          champion: "Zeri",
          ban1: "Maokai",
          ban2: "Ivern",
          ban3: "Vi",
          ban4: "Rakan",
          ban5: "Leona",
          k: 1,
          d: 0,
          a: 0,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 1,
          oppdragkills: 0,
          elementals: 1,
          oppelementals: 0,
          herald: "",
          wards: 5,
          csat10: 96,
          oppcsat10: 90,
          csdat10: 6,
          results: 0,
        },
        {
          side: "Red",
          position: "Support",
          player: "Keria",
          team: "T1",
          champion: "Lulu",
          ban1: "Maokai",
          ban2: "Ivern",
          ban3: "Vi",
          ban4: "Rakan",
          ban5: "Leona",
          k: 0,
          d: 0,
          a: 1,
          fb: 0,
          fbassist: 0,
          fbvictim: 0,
          fbtime: 3.53,
          fd: 0,
          fdtime: 6.35,
          heraldtime: "",
          teamdragkills: 1,
          oppdragkills: 0,
          elementals: 1,
          oppelementals: 0,
          herald: "",
          wards: 2,
          csat10: 8,
          oppcsat10: 19,
          csdat10: -11,
          results: 0,
        },
      ];

      // Render CSV as editable table
      function renderTable() {
        const table = document.getElementById("csv-table");
        table.innerHTML = "";

        const headerRow = document.createElement("tr");
        Object.keys(csvData[0]).forEach((col) => {
          const th = document.createElement("th");
          th.innerText = col;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        csvData.forEach((row, i) => {
          if (i > 0 && row.side === "Red" && csvData[i - 1].side === "Blue") {
            let sep = document.createElement("tr");
            sep.classList.add("team-separator");
            let td = document.createElement("td");
            td.colSpan = Object.keys(row).length;
            sep.appendChild(td);
            table.appendChild(sep);
          }

          let tr = document.createElement("tr");
          tr.classList.add(row.side === "Blue" ? "blue-team" : "red-team");

          Object.keys(row).forEach((col) => {
            const td = document.createElement("td");
            td.contentEditable = col !== "results";
            td.innerText = row[col];
            td.oninput = () => (csvData[i][col] = td.innerText);
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
      }

      renderTable();

      // Send to backend API
      async function sendToAPI() {
        try {
          const response = await fetch(
            "https://league-predictor-production.up.railway.app/predict_csv",
            {
              method: "POST",
              body: csvToFormData(),
            }
          );
          const result = await response.json();
          displayResults(result);
        } catch (err) {
          document.getElementById("results").innerText =
            "Error: " + err.message;
        }
      }

      // Convert CSVData to FormData with CSV file
      function csvToFormData() {
        let csvContent = "";
        const headers = Object.keys(csvData[0]);
        csvContent += headers.join(",") + "\n";
        csvData.forEach((row) => {
          csvContent += headers.map((h) => row[h]).join(",") + "\n";
        });

        const blob = new Blob([csvContent], { type: "text/csv" });
        const file = new File([blob], "input.csv", { type: "text/csv" });

        const formData = new FormData();
        formData.append("file", file);
        return formData;
      }

      // Display prediction results in a nicer format
      function displayResults(data) {
        const container = document.getElementById("results");
        container.innerHTML = "";

        // Team summaries
        const teamSummary = document.createElement("div");
        teamSummary.classList.add("team-summary");

        let summaryHTML = "<h2>Team Winning Probabilities</h2>";
        for (const [team, prob] of Object.entries(data.team_probabilities)) {
          summaryHTML += `<p>${team}: <span>${prob.toFixed(2)}%</span></p>`;
        }
        teamSummary.innerHTML = summaryHTML;
        container.appendChild(teamSummary);

        // Player table
        const playerTable = document.createElement("table");

        const headerRow = document.createElement("tr");
        [
          "Side",
          "Position",
          "Player",
          "Team",
          "Champion",
          "Win Probability",
          "Predicted Result",
        ].forEach((h) => {
          const th = document.createElement("th");
          th.innerText = h;
          headerRow.appendChild(th);
        });
        playerTable.appendChild(headerRow);

        data.players.forEach((p) => {
          const tr = document.createElement("tr");
          tr.classList.add(p.side === "Blue" ? "blue-team" : "red-team");

          const cells = [
            p.side,
            p.position,
            p.player,
            p.team,
            p.champion,
            p.win_probability + "%",
            p.predicted_result === 1 ? "Win" : "Loss",
          ];

          cells.forEach((val) => {
            const td = document.createElement("td");
            td.innerText = val;
            tr.appendChild(td);
          });

          playerTable.appendChild(tr);
        });

        container.appendChild(playerTable);
      }
    </script>
  </body>
</html>
